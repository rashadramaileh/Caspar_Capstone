@page
@model CASPAR.Pages.Students.UpsertModel

@{
    
}
<form method="post" asp-page="Upsert" onsubmit="return ValidateInput()" enctype="multipart/form-data" onload="getHtml()">
    <input asp-for="objStudentWishlist.StudentWishlistId" hidden />
    <div class="row">
        <div class="col-10">
            <div class="border p-3 mt-4 row">
                <div class="col-12 pb-2">
                    <h2 class="text-primary">@(Model.objStudentWishlistDetails.StudentWishlistDetailsId != 0 ? "Update " : "Create ") Wishlist</h2>
                    <hr />
                </div>
                <div class="mb-3 col-6">
                    <label asp-for="objStudentWishlistDetails.Course"></label>
                    <select id="ddlCourse" asp-for="objStudentWishlistDetails.CourseId" asp-items="@Model.CourseList" class="form-select">
                        <option disabled selected>--Select Course--</option>
                    </select>
                </div>

                <div class="mb-3 col-6">
                    <div>
                    @for (var i = 0; i < Model.modalityCheck.Count; i++)
                    {
                        @*<label>@modality.Text
                        <input type="checkbox" name="modalityCheck" value="@modality.Value" checked="@modality.Checked" onclick="ShowDiv(this)" id="@modality.Text" asp-items="@Model.modalityCheck" />
                        </label>*@
                        @*<input asp-for="@modality.Checked" id="@modality.Value" type="checkbox" name="Modality" value="@modality.Checked"/>
                        <label asp-for="@modality.Value">@modality.Text</label>
                        <input asp-for="@modality.Value" hidden />
                        <input asp-for="@modality.Disabled" hidden />*@
                        <input type="checkbox" asp-for="@Model.modalityCheck[i].Checked" onclick="testing(@Model.modalityCheck[i].Value, '@Model.modalityCheck[i].Text')" id="@Model.modalityCheck[i].Value" />
                        <label asp-for="@Model.modalityCheck[i].Checked">@Model.modalityCheck[i].Text</label>
                        <input type="hidden" asp-for="@Model.modalityCheck[i].Value" />
                        <input type="hidden" asp-for="@Model.modalityCheck[i].Text" />
                        <input type="hidden" asp-for="@Model.modalityCheck[i].Disabled" />
                    }
                    </div>
                </div>

                @{var j = 0;}
                @for (var i = 0; i < Model.modalityCheck.Count; i++)
                { 
                    if (!Model.modalityCheck[i].Text.Contains("Online") && !Model.modalityCheck[i].Text.Contains("Flex"))
                    {
                        <div id="@Model.modalityCheck[i].Text" style="display: none;" class="mb-3 col-12">
                            <h5>@Model.modalityCheck[i].Text</h5>
                            <button type="button" onclick="AddAnotherItem('@Model.modalityCheck[i].Text')">Add Another Time</button>

                            <div class="count">
                            
                                <br>
                                <label asp-for="objStudentTime[j].TimeBlock">Time</label>
                                <select id="ddlDayBlock" asp-for="objStudentTime[j].TimeBlockId" asp-items="@Model.TimeList" class="form-select">
                                    <option disabled selected>--Select Time--</option>
                                </select>
                            
                                <label asp-for="objStudentTime[j].Campus">Campus</label>
                                <select id="ddlCampus" asp-for="objStudentTime[j].CampusId" asp-items="@Model.CampusList" class="form-select">
                                    <option disabled selected>--Select Campus--</option>
                                </select>

                                <i class="bi bi-trash" id="@j" onclick="removeDiv(this)" style="display:none"></i>

                                <input type="hidden" asp-for="objStudentTime[j].StudentWishlistModalityId" value="@Model.modalityCheck[i].Value"/>
                            </div>
                        </div>
                        j++;
                    }
                }
                <div class="col-12">
                    @if (Model.objStudentWishlistDetails.StudentWishlistDetailsId != 0)
                    {
                        <button type="submit" onclick="return ValidateInput()" class="btn btn-primary" style="width:150px">Update</button>
                    }
                    else
                    {
                        <button type="submit" onclick="return ValidateInput()" class="btn btn-primary" style="width:150px">Create</button>
                    }
                    <!--END ELSE -->
                    <a asp-page="/Students/StudentWishlistHome" class="btn btn-secondary" style="width:150px">
                        Back to List
                    </a>
                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts
{
    <script>
      
        tinymce.init({
            selector: 'textarea',
            plugins: "lists",
            menubar: "file edit format"
        });

        function testing(value, text){
            var checkBox = document.getElementById(value)
            var text = document.getElementById(text)
            if (checkBox.checked) {
                text.style.display = "inline";
            }
            else{
                text.style.display = "none";
            }
        }

        function AddAnotherItem(text){
            //Gets current count of items available
            var count = document.getElementsByClassName('count').length
            //Getting correct Modality
            var textBox = document.getElementById(text)
            //Getting drop down value node
            var child = textBox.childNodes[5]
            //Cloning the node to use for future node
            const node = child.cloneNode(true)
            //Setting up the correct values for the new node
            node.id = 'input' + count;
            var childVal = child.innerHTML
            document.getElementById(text).appendChild(node)
            var newParent = document.getElementById('input' + count)
            var newChild = newParent.childNodes[3]
            newChild.setAttribute("for", "objStudentTime_" + count + "__TimeBlock")
            newChild = newParent.childNodes[5]
            newChild.setAttribute("name", "objStudentTime[" + count + "].TimeBlockId")
            newChild = newParent.childNodes[7]
            newChild.setAttribute("for", "objStudentTime_" + count + "__Campus")
            newChild = newParent.childNodes[9]
            newChild.setAttribute("name", "objStudentTime[" + count + "].CampusId")
            newChild = newParent.childNodes[13]
            newChild.setAttribute("id", "objStudentTime_" + count + "__StudentWishlistModalityId")
            newChild.setAttribute("name", "objStudentTime[" + count + "].StudentWishlistModalityId")
            newChild = newParent.childNodes[11]
            newChild.setAttribute("id", count)
            newChild.setAttribute("style", "display:inline")
        }

        function removeDiv(value){
            var toRemove = document.getElementById(value.id).closest("div div")
            return toRemove.remove();
        }

        function ValidateInput() 
        {

            if ($('#ddlCourse option:selected').val() == 0) {
                swal.fire('Error', 'Please Select a Course', 'error')
                return false
            }

            if ($('#ddlFormat option:selected').val() == 0) {
                swal.fire('Error', 'Please Select a Format', 'error')
                return false
            }

            if ($('#ddlCampus option:selected').val() == 0) {
                swal.fire('Error', 'Please Select a Campus', 'error')
                return false
            }

            if ($('#ddlTimeBlock option:selected').val() == 0) {
                swal.fire('Error', 'Please Select a Time', 'error')
                return false
            }
            if ($('#ddlSemester option:selected').val() == 0) {
                swal.fire('Error', 'Please Select a Semester', 'error')
                return false
            }

            return true;
        }
    </script>
}
